<ion-content class="login-wrapper" fullscreen>
  <div class="viewport">
    <div class="container">
      <div class="brand">
        <div class="brand-icon"><ion-icon name="checkmark-outline"></ion-icon></div>
        <div class="brand-name">SmartPOS</div>
      </div>

      <form [formGroup]="form" (ngSubmit)="submit()" novalidate aria-label="Formulario de inicio de sesión">
        <h1 class="title">Iniciar sesión</h1>

        <ion-item class="input-item" lines="none">
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-input type="email" inputmode="email" autocomplete="email" formControlName="email" aria-required="true" placeholder="Correo"></ion-input>
        </ion-item>
        @if (f['email'].touched && f['email'].invalid) {
          <div class="error">
            @if (f['email'].errors?.['required']) {
              <span>El correo es obligatorio.</span>
            }
            @if (f['email'].errors?.['email']) {
              <span>Formato de correo inválido.</span>
            }
          </div>
        }

        <ion-item class="input-item" lines="none">
          <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
          <ion-input
            [type]="showPassword ? 'text' : 'password'"
            autocomplete="current-password"
            formControlName="password"
            aria-required="true"
            placeholder="Contraseña"
            autocapitalize="off"
            spellcheck="false"
            [maxlength]="64"
            (keydown)="onPasswordKeyEvent($event)"
            (keyup)="onPasswordKeyEvent($event)"
          ></ion-input>
          <ion-button fill="clear" slot="end" (click)="togglePassword()" aria-label="Mostrar u ocultar contraseña">
            <ion-icon [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
          </ion-button>
        </ion-item>
        @if (f['password'].touched && f['password'].invalid) {
          <div class="error" aria-live="polite">
            @if (f['password'].errors?.['required']) {
              <span>La contraseña es obligatoria.</span>
            }
            @if (f['password'].errors?.['minlength']) {
              <span>Mínimo 6 caracteres.</span>
            }
            @if (f['password'].errors?.['invalid']) {
              <span>Credenciales inválidas.</span>
            }
          </div>
        }
        @if (capsLockOn) {
          <div class="error" aria-live="polite">Caps Lock activado.</div>
        }

        <ion-item lines="none" class="remember-row">
          <ion-checkbox formControlName="remember" aria-label="Recordar credenciales"></ion-checkbox>
          <ion-label>Recordar credenciales</ion-label>
        </ion-item>

        <div class="actions">
          <ion-button type="submit" expand="block" [disabled]="form.invalid">Iniciar Sesión</ion-button>
          <a class="forgot" href="#" aria-label="Recuperar contraseña">¿Olvidaste tu contraseña?</a>
        </div>

        @if ((online$ | async) === false) {
          <div class="offline" role="status">
            Sin conexión. El inicio de sesión requiere conexión al servidor.
          </div>
        }
      </form>
    </div>
  </div>
</ion-content>
