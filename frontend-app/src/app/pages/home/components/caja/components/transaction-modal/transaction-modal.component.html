<div class="modal-wrapper">
  <div class="modal-header">
    <h2>{{ title }}</h2>
  </div>
  
  <div class="modal-body">
    <p *ngIf="message" class="message-text">{{ message }}</p>

    <form [formGroup]="form" (ngSubmit)="confirm()">
      
      <div class="form-group">
        <ion-item lines="full" class="input-item">
          <!-- type="text" es importante para permitir los puntos -->
          <!-- inputmode="numeric" muestra el teclado numérico en móviles -->
          <ion-input
            type="text"
            inputmode="numeric"
            formControlName="monto"
            [placeholder]="amountLabel"
            appNumericFormat
            class="amount-input"
          ></ion-input>
        </ion-item>
        <div class="error-text" *ngIf="form.get('monto')?.touched && form.get('monto')?.invalid">
          Monto requerido
        </div>
      </div>

      <!-- Campo de Monto Recibido (Solo visible si showCashPaymentFields es true) -->
      <div class="form-group" *ngIf="showCashPaymentFields">
        <ion-item lines="full" class="input-item">
          <ion-input
            type="text"
            inputmode="numeric"
            formControlName="montoRecibido"
            [placeholder]="amountReceivedLabel"
            appNumericFormat
            class="amount-input secondary-amount"
          ></ion-input>
        </ion-item>
        
        <!-- Mostrar cambio calculado en tiempo real -->
        <div class="change-display" *ngIf="cambio > 0">
          <span class="label">Cambio/Vuelto:</span>
          <span class="value">{{ cambio | currency:'USD':'symbol':'1.0-0' }}</span>
        </div>
      </div>

      <div class="form-group" *ngIf="showPaymentMethodSelector">
        <label style="display: block; font-size: 14px; font-weight: 600; color: #444; margin-bottom: 8px;">Origen de Fondos</label>
        
        <div class="payment-method-selector">
          <!-- Opción 1: Caja Efectivo -->
          <div class="payment-option" 
               [class.selected]="form.get('metodoPago')?.value === 'EFECTIVO'"
               (click)="form.get('metodoPago')?.setValue('EFECTIVO')">
            <div class="radio-circle"></div>
            <div class="option-info">
              <h4>Caja (Efectivo)</h4>
              <p>Descuenta del saldo en efectivo</p>
            </div>
            <ion-icon name="cash-outline"></ion-icon>
          </div>

          <!-- Opción 2: Caja Transferencia -->
          <div class="payment-option" 
               [class.selected]="form.get('metodoPago')?.value === 'TRANSFERENCIA'"
               (click)="form.get('metodoPago')?.setValue('TRANSFERENCIA')">
            <div class="radio-circle"></div>
            <div class="option-info">
              <h4>Caja (Transferencia)</h4>
              <p>Descuenta del saldo digital (Nequi/Bancos)</p>
            </div>
            <ion-icon name="phone-portrait-outline"></ion-icon>
          </div>

          <!-- Opción 3: Externo -->
          <div class="payment-option" 
               [class.selected]="form.get('metodoPago')?.value === 'EXTERNO'"
               (click)="form.get('metodoPago')?.setValue('EXTERNO')">
            <div class="radio-circle"></div>
            <div class="option-info">
              <h4>Fondos Externos</h4>
              <p>No afecta el cuadre del día</p>
            </div>
            <ion-icon name="wallet-outline"></ion-icon>
          </div>
        </div>
      </div>

      <div class="form-group">
        <ion-item lines="full" class="input-item">
          <ion-input
            type="text"
            formControlName="descripcion"
            [placeholder]="descriptionLabel"
          ></ion-input>
        </ion-item>
        <div class="error-text" *ngIf="descriptionRequired && form.get('descripcion')?.touched && form.get('descripcion')?.invalid">
          Requerido
        </div>
      </div>

      <div class="modal-footer">
        <ion-button fill="clear" color="primary" (click)="cancel()">
          {{ cancelText | uppercase }}
        </ion-button>
        <ion-button fill="clear" color="primary" type="submit">
          {{ confirmText | uppercase }}
        </ion-button>
      </div>

    </form>
  </div>
</div>
