<div class="toolbar">
  <div class="search-wrapper">
    <ion-icon name="search-outline" class="search-icon"></ion-icon>
    <input 
      type="text" 
      placeholder="Buscar cliente..." 
      (input)="onSearchInput($event)"
      class="custom-search-input">
  </div>

  <div class="filter-wrapper">
    <ion-select [value]="filterEstado" (ionChange)="onFilterChange($event)" interface="popover" mode="ios">
      <ion-select-option value="PENDIENTE">Pendientes</ion-select-option>
      <ion-select-option value="VENCIDO">Vencidos</ion-select-option>
      <ion-select-option value="PAGADO">Pagados</ion-select-option>
      <ion-select-option value="TODOS">Todos</ion-select-option>
    </ion-select>
  </div>
</div>

<div class="table-container">
  <table class="data-table">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Fecha</th>
        <th>Vencimiento</th>
        <th>Monto Total</th>
        <th>Saldo</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      @if (loading) {
        @for (i of skeletonRows; track i) {
          <tr class="skeleton-row">
            <td>
              <div style="display: flex; flex-direction: column; gap: 5px;">
                <ion-skeleton-text animated style="width: 70%; height: 16px; border-radius: 4px;"></ion-skeleton-text>
                <ion-skeleton-text animated style="width: 40%; height: 12px; border-radius: 4px;"></ion-skeleton-text>
              </div>
            </td>
            <td><ion-skeleton-text animated style="width: 80%; height: 16px; border-radius: 4px;"></ion-skeleton-text></td>
            <td><ion-skeleton-text animated style="width: 80%; height: 16px; border-radius: 4px;"></ion-skeleton-text></td>
            <td><ion-skeleton-text animated style="width: 60%; height: 16px; border-radius: 4px;"></ion-skeleton-text></td>
            <td><ion-skeleton-text animated style="width: 60%; height: 16px; border-radius: 4px;"></ion-skeleton-text></td>
            <td><ion-skeleton-text animated style="width: 50%; height: 20px; border-radius: 10px;"></ion-skeleton-text></td>
            <td><ion-skeleton-text animated style="width: 80px; height: 30px; border-radius: 8px;"></ion-skeleton-text></td>
          </tr>
        }
      } @else {
        @for (deuda of filteredDeudas; track deuda) {
        <tr>
          <td data-label="Cliente">
            <div class="client-info">
              <span class="name">{{ deuda.cliente?.nombre }}</span>
              <span class="cedula">{{ deuda.cliente?.cedula }}</span>
            </div>
          </td>
          <td data-label="Fecha">{{ deuda.fechaCreacion | date:'shortDate' }}</td>
          <td data-label="Vencimiento">{{ deuda.fechaVencimiento ? (deuda.fechaVencimiento | date:'shortDate') : '-' }}</td>
          <td data-label="Monto Total">{{ deuda.montoTotal | currency:'USD' }}</td>
          <td data-label="Saldo" class="amount-pending">{{ deuda.saldoPendiente | currency:'USD' }}</td>
          <td data-label="Estado">
            <ion-badge [color]="deuda.estado === 'PAGADO' ? 'success' : (deuda.estado === 'VENCIDO' ? 'danger' : 'warning')">
              {{ deuda.estado }}
            </ion-badge>
          </td>
          <td data-label="Acciones">
            @if (deuda.estado !== 'PAGADO') {
              <ion-button size="small" (click)="registrarAbono(deuda)">
                <ion-icon slot="start" name="cash-outline"></ion-icon>
                Abonar
              </ion-button>
            }
          </td>
        </tr>
      }
      @if (filteredDeudas.length === 0) {
        <tr>
          <td colspan="7" class="empty-state">
            <div class="empty-content">
              <ion-icon name="file-tray-outline"></ion-icon>
              <h3>No se encontraron deudas</h3>
              <p>Intenta ajustar los filtros de b√∫squeda</p>
            </div>
          </td>
        </tr>
      }
      }
    </tbody>
  </table>
</div>
