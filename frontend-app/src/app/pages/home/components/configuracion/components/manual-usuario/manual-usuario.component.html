<div class="manual-container">
  <!-- Cabecera y Bienvenida -->
  <div class="manual-header ion-padding">
    <div class="header-content animate-fade-in">
      <h1 class="main-title">Centro de Ayuda SmartPOS</h1>
      <p class="subtitle">Todo lo que necesitas saber para dominar tu negocio</p>
    </div>

    <div class="search-box-wrapper animate-slide-up">
      <ion-searchbar [(ngModel)]="searchText" placeholder="¿Qué estás buscando? (ej. ventas, stock...)"
        class="custom-searchbar" mode="ios" animated="true">
      </ion-searchbar>
    </div>
  </div>

  <div class="manual-body ion-padding">
    <!-- Intro Card -->
    <div class="intro-card animate-fade-in" *ngIf="!searchText">
      <div class="intro-icon">
        <ion-icon name="bulb-outline"></ion-icon>
      </div>
      <div class="intro-text">
        <h3>Bienvenido a tu Guía Digital</h3>
        <p>Explora los módulos a continuación para aprender paso a paso cómo utilizar cada función del sistema. Cada
          paso incluye una imagen descriptiva para facilitar tu aprendizaje.</p>
      </div>
    </div>

    <!-- No Results State -->
    <div class="no-results" *ngIf="filteredSections.length === 0">
      <ion-icon name="search-outline"></ion-icon>
      <h3>No encontramos resultados</h3>
      <p>Prueba con otras palabras clave o navega por los módulos principales.</p>
      <ion-button fill="clear" (click)="searchText = ''">Ver todo el manual</ion-button>
    </div>

    <ion-accordion-group [multiple]="true" class="custom-accordion">

      <ion-accordion *ngFor="let section of filteredSections" [value]="section.id" class="animate-item">
        <ion-item slot="header" lines="none" class="accordion-header-item">
          <div class="header-icon-wrapper" slot="start">
            <ion-icon [name]="section.icon"></ion-icon>
          </div>
          <ion-label class="accordion-label">
            <h2>{{ section.title }}</h2>
            <p class="section-short-desc">{{ section.description }}</p>
          </ion-label>
        </ion-item>

        <div class="content-wrapper" slot="content">
          <div class="module-intro" *ngIf="section.longDescription">
            <h4 class="intro-title">Objetivo del Módulo</h4>
            <p>{{ section.longDescription }}</p>
          </div>

          <div class="steps-container" *ngIf="section.steps.length > 0">
            <div class="step-card outer-step-card" *ngFor="let step of section.steps; let i = index">
              <div class="step-header">
                <div class="step-number">{{ i + 1 }}</div>
                <h3 class="step-title">{{ step.title }}</h3>
              </div>

              <div class="step-content">
                <div class="step-image-container" (click)="openImage(step.image, step.title)">
                  <img [src]="step.image" [alt]="step.title" loading="lazy">
                  <div class="zoom-overlay">
                    <ion-icon name="expand-outline"></ion-icon>
                    <span>Toca para ampliar</span>
                  </div>
                </div>

                <div class="step-description">
                  <p>{{ step.description }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ion-accordion>

    </ion-accordion-group>
  </div>

  <!-- Modal para ver imágenes en grande -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="isModalOpen = false" class="fullscreen-image-modal">
    <ng-template>
      <div class="modal-content-wrapper" (click)="isModalOpen = false">
        <div class="modal-header-bar">
          <div class="modal-info">
            <span class="modal-title">{{ selectedTitle }}</span>
          </div>
          <ion-button fill="clear" class="modal-close-btn" (click)="isModalOpen = false">
            <ion-icon name="close-circle"></ion-icon>
          </ion-button>
        </div>
        <div class="modal-image-box">
          <img [src]="selectedImage" class="modal-image" (click)="$event.stopPropagation()" />
        </div>
      </div>
    </ng-template>
  </ion-modal>
</div>